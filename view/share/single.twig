{% extends 'default.twig' %}

{% block body %}
   <div class="row">
      <div class="col-md-9">
         <div class="panel panel-default">
            <div class="panel-heading" style="padding-bottom: 20px;">
               <div style="font-size: 200%; padding-bottom: 10px;">{{ share.title }}</div class="share-title">
               <small><i class="fa fa-tag mr-7"></i><span class="grey">{{ share.cat_name }}</span></small>
               <small><i class="fa fa-eye mr-7"></i><span class="grey">{{ share.views }}</span></small>
               <small><i class="fa fa-clock-o mr-7"></i><span class="grey">{{ share.created_at | diffForHumans }}</span></small>
            </div>

            <div class="panel-body">
               {{ share.body | markdown }}
               <hr>

               <div id="likeButton">
                  {% set id = auth.check ? auth.user.id : 0 %}
                  <div style="margin-bottom: 10px;" data-url="/share/{{ share.id }}/like"
                       class="btn {{ isLiked(id, share.id) ? 'btn-success' : 'btn-default' }}" {{ auth.check ? '' : 'disabled' }}>
                     <i class="fa fa-thumbs-o-up fa-lg mr-7"></i>好野  (<span>{{ share.likes }}</span>)
                  </div>
               </div>

               <div id="likedDetails">
                  {% if likedUsers %}
                     {% for user in likedUsers %}
                         <span id="liked-by-{{user.id}}">{{ gravatar(30, user.email) | raw }}</span>
                     {% endfor %}
                  {% endif %}
               </div>

            </div> <!-- end panel body -->
         </div> <!-- end panel -->
      </div> <!-- end col-9 -->

      <div class="col-md-3">
         <div class="panel panel-info">
            <div class="panel-heading" style="text-align: center">作者</div>
            <div class="panel-body" style="text-align: center;">
               {{ gravatar(120, share.email) | raw }}
               <div class="grey">{{ share.username }}</div>
               {% if share.description %}
                  <div style="margin-top: 15px;">{{ share.description }}</div >
               {% endif %}

               {% if share.github %}
                  <div id="github-link" style="margin-top: 15px;">
                     <a href="https://github.com/{{ share.github }}" target="_blank">
                        <i class="fa fa-github mr-7"></i>Github
                     </a>
                  </div>
               {% endif %}
            </div>
         </div>

         {% if others %}
            <div class="panel panel-success">
               <div class="panel-heading" style="text-align: center">作者的其他分享</div>
               <div class="panel-body">
                  {% for other in others %}
                     <a style="font-size: 120%; display: block; padding-bottom: 5px;" class="share-title plink" href="/share/{{ other.id }}">
                        <i class="fa fa-caret-right mr-7" aria-hidden="true"></i>{{ other.title }}
                     </a>
                  {% endfor %}
               </div>
            </div>
         {% endif %}
      </div>

   </div> <!-- end row -->
   <script src="/js/md5.js"></script>
   <script>
      $('pre code').each(function(i, block) {
         hljs.highlightBlock(block)
      })

      $('#likeButton > div').click(function(e){
         e.preventDefault()
         var btn = $(this)
         var span = btn.find('span')
         var count = parseInt(span.text())
         $.getJSON($(this).data('url')).done(function(res){
            if (btn.hasClass('btn-default')) {
               btn.removeClass('btn-default').addClass('btn-success')
               count++
               span.text(count)
               var g = '<span style="display: none" id="liked-by-'+res.id+'">'+
                       '<img class="gravatar" src="https://www.gravatar.com/avatar/'+md5(res.email)+'?s=30&d=mm"></span>'
               $('#likedDetails').prepend(g)
               $('#liked-by-'+res.id).fadeIn()
            } else {
               btn.removeClass('btn-success').addClass('btn-default')
               count--
               span.text(count)
               $('#liked-by-'+res.id).fadeOut(function(){
                  $(this).remove()
               })
            }
         })
      })
   </script>
{% endblock %}